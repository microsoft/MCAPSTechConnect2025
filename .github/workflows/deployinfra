name: CI/CD Pipeline

on:
  push:
    branches:
      - main  # Trigger pipeline to deploy infrastructure

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Deploy Infrastructure using Bicep
    - name: Deploy Infrastructure
      uses: azure/cli-action@v1
      with:
        inlineScript: |
          az login --service-principal --username ${{ secrets.AZURE_CLIENT_ID }} \
            --password ${{ secrets.AZURE_CLIENT_SECRET }} \
            --tenant ${{ secrets.AZURE_TENANT_ID }}
          az deployment group create \
            --resource-group ${{ secrets.RESOURCE_GROUP_NAME }} \
            --template-file src/Infra/main.bicep \
            --parameters @src/Infra/parameters.json
